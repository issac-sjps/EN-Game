<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Preposition Practice Game</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 20px;
      font-family: 'Comic Sans MS', 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    h1 {
      text-align: center;
      color: #667eea;
      margin: 0 0 10px 0;
      font-size: 32px;
    }

    .score-board {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .score-item {
      text-align: center;
    }

    .score-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }

    .score-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }

    .question-area {
      margin: 30px 0;
      padding: 20px;
      background: #fff9e6;
      border-radius: 10px;
      border: 3px solid #ffd700;
    }

    .question-text {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    .game-area {
      position: relative;
      width: 100%;
      height: 400px;
      background: #e8f4f8;
      border-radius: 15px;
      margin: 20px 0;
      overflow: hidden;
    }

    .table {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: 150px;
      background: #8b4513;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .table::after {
      content: '';
      position: absolute;
      bottom: -80px;
      left: 20px;
      width: 20px;
      height: 80px;
      background: #654321;
      border-radius: 5px;
    }

    .table::before {
      content: '';
      position: absolute;
      bottom: -80px;
      right: 20px;
      width: 20px;
      height: 80px;
      background: #654321;
      border-radius: 5px;
    }

    .drawer {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 280px;
      height: 80px;
      background: #654321;
      border-radius: 8px;
      margin-top: 75px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
      border: 2px solid #4a2c17;
    }

    .drawer::after {
      content: '';
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 15px;
      height: 15px;
      background: #333;
      border-radius: 50%;
      box-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .draggable-object {
      position: absolute;
      width: 60px;
      height: 60px;
      background: #ff6b6b;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      cursor: move;
      user-select: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s;
      z-index: 10;
    }

    .draggable-object:hover {
      transform: scale(1.1);
    }

    .draggable-object.dragging {
      opacity: 0.7;
      transform: scale(1.15);
    }

    .drop-zone {
      position: absolute;
      width: 80px;
      height: 80px;
      border: 3px dashed transparent;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .drop-zone.highlight {
      border-color: #4CAF50;
      background: rgba(76, 175, 80, 0.1);
    }

    .feedback {
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .feedback.correct {
      background: #d4edda;
      color: #155724;
      border: 2px solid #28a745;
    }

    .feedback.incorrect {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #dc3545;
    }

    .feedback.hidden {
      visibility: hidden;
    }

    .chinese-answer {
      font-size: 16px;
      margin-top: 8px;
      color: #666;
    }

    .next-button {
      display: block;
      margin: 20px auto;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .next-button:hover {
      background: #5568d3;
    }

    .next-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .completion-screen {
      text-align: center;
      padding: 40px;
    }

    .completion-screen h2 {
      color: #667eea;
      font-size: 36px;
      margin-bottom: 20px;
    }

    .final-score {
      font-size: 48px;
      color: #28a745;
      margin: 20px 0;
    }

    .restart-button {
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .restart-button:hover {
      background: #218838;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <h1 id="game-title">Preposition Practice Game</h1>
   <div class="score-board">
    <div class="score-item">
     <div class="score-label">
      Question
     </div>
     <div class="score-value">
      <span id="current-question">1</span> / 20
     </div>
    </div>
    <div class="score-item">
     <div class="score-label">
      Correct
     </div>
     <div class="score-value" id="correct-count">
      0
     </div>
    </div>
    <div class="score-item">
     <div class="score-label">
      Accuracy
     </div>
     <div class="score-value" id="accuracy">
      0%
     </div>
    </div>
   </div>
   <div id="game-content">
    <div class="question-area">
     <div class="question-text" id="question-text">
      Put the apple ON the table
     </div>
    </div>
    <div class="game-area" id="game-area">
     <div class="table"></div>
     <div class="drawer"></div>
     <div class="draggable-object" id="draggable">
      üçé
     </div>
    </div>
    <div class="feedback hidden" id="feedback"></div><button class="next-button" id="next-button" disabled>Next Question (Êåâ‰∏ãÁ©∫ÁôΩÈçµ)</button>
   </div>
   <div id="completion-screen" style="display: none;" class="completion-screen">
    <h2>üéâ Congratulations! üéâ</h2>
    <div class="final-score" id="final-score">
     20 / 20
    </div>
    <p style="font-size: 20px; color: #666;">You've completed all questions!</p><button class="restart-button" onclick="restartGame()">Play Again</button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "Preposition Practice Game",
      instruction_text: "Drag the object to the correct position",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      text_color: "#333333",
      accent_color: "#ffd700",
      success_color: "#28a745"
    };

    const questions = [
      { text: "Put the apple ON the table", position: "on", emoji: "üçé", chinese: "Âú®Ê°åÂ≠ê‰∏ä" },
      { text: "Put the book UNDER the table", position: "under", emoji: "üìö", chinese: "Âú®Ê°åÂ≠ê‰∏ãÈù¢" },
      { text: "Put the cup to the LEFT of the table", position: "left", emoji: "‚òï", chinese: "Âú®Ê°åÂ≠êÂ∑¶ÈÇä" },
      { text: "Put the ball to the RIGHT of the table", position: "right", emoji: "‚öΩ", chinese: "Âú®Ê°åÂ≠êÂè≥ÈÇä" },
      { text: "Put the flower IN the drawer", position: "in", emoji: "üå∏", chinese: "Âú®ÊäΩÂ±úË£°" },
      { text: "Put the cat UNDER the table", position: "under", emoji: "üê±", chinese: "Âú®Ê°åÂ≠ê‰∏ãÈù¢" },
      { text: "Put the phone ON the table", position: "on", emoji: "üì±", chinese: "Âú®Ê°åÂ≠ê‰∏ä" },
      { text: "Put the toy to the LEFT of the table", position: "left", emoji: "üß∏", chinese: "Âú®Ê°åÂ≠êÂ∑¶ÈÇä" },
      { text: "Put the lamp to the RIGHT of the table", position: "right", emoji: "üí°", chinese: "Âú®Ê°åÂ≠êÂè≥ÈÇä" },
      { text: "Put the box IN the drawer", position: "in", emoji: "üì¶", chinese: "Âú®ÊäΩÂ±úË£°" },
      { text: "Put the cake ON the table", position: "on", emoji: "üç∞", chinese: "Âú®Ê°åÂ≠ê‰∏ä" },
      { text: "Put the shoe UNDER the table", position: "under", emoji: "üëü", chinese: "Âú®Ê°åÂ≠ê‰∏ãÈù¢" },
      { text: "Put the plant to the LEFT of the table", position: "left", emoji: "üåø", chinese: "Âú®Ê°åÂ≠êÂ∑¶ÈÇä" },
      { text: "Put the bag to the RIGHT of the table", position: "right", emoji: "üëú", chinese: "Âú®Ê°åÂ≠êÂè≥ÈÇä" },
      { text: "Put the clock IN the drawer", position: "in", emoji: "‚è∞", chinese: "Âú®ÊäΩÂ±úË£°" },
      { text: "Put the hat UNDER the table", position: "under", emoji: "üé©", chinese: "Âú®Ê°åÂ≠ê‰∏ãÈù¢" },
      { text: "Put the gift ON the table", position: "on", emoji: "üéÅ", chinese: "Âú®Ê°åÂ≠ê‰∏ä" },
      { text: "Put the pencil to the LEFT of the table", position: "left", emoji: "‚úèÔ∏è", chinese: "Âú®Ê°åÂ≠êÂ∑¶ÈÇä" },
      { text: "Put the star to the RIGHT of the table", position: "right", emoji: "‚≠ê", chinese: "Âú®Ê°åÂ≠êÂè≥ÈÇä" },
      { text: "Put the key IN the drawer", position: "in", emoji: "üîë", chinese: "Âú®ÊäΩÂ±úË£°" }
    ];

    let currentQuestionIndex = 0;
    let correctCount = 0;
    let hasAnswered = false;

    let draggedElement = null;
    let offsetX = 0;
    let offsetY = 0;

    function initGame() {
      loadQuestion();
      setupDragAndDrop();
    }

    function loadQuestion() {
      const question = questions[currentQuestionIndex];
      
      // Highlight keywords in red
      let questionText = question.text;
      const keywords = ['ON', 'UNDER', 'LEFT', 'RIGHT', 'IN'];
      keywords.forEach(keyword => {
        questionText = questionText.replace(new RegExp(`\\b${keyword}\\b`, 'g'), `<span style="color: #dc3545; font-weight: bold;">${keyword}</span>`);
      });
      
      document.getElementById('question-text').innerHTML = questionText;
      document.getElementById('draggable').textContent = question.emoji;
      document.getElementById('current-question').textContent = currentQuestionIndex + 1;
      document.getElementById('feedback').className = 'feedback hidden';
      document.getElementById('next-button').disabled = true;
      hasAnswered = false;

      const draggable = document.getElementById('draggable');
      draggable.style.left = '50px';
      draggable.style.top = '50px';
    }

    function setupDragAndDrop() {
      const draggable = document.getElementById('draggable');
      const gameArea = document.getElementById('game-area');

      draggable.addEventListener('mousedown', startDrag);
      draggable.addEventListener('touchstart', startDrag);

      document.addEventListener('mousemove', drag);
      document.addEventListener('touchmove', drag);

      document.addEventListener('mouseup', endDrag);
      document.addEventListener('touchend', endDrag);
    }

    function startDrag(e) {
      if (hasAnswered) return;

      draggedElement = e.target;
      draggedElement.classList.add('dragging');

      const rect = draggedElement.getBoundingClientRect();
      const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
      const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

      offsetX = clientX - rect.left;
      offsetY = clientY - rect.top;

      e.preventDefault();
    }

    function drag(e) {
      if (!draggedElement) return;

      const gameArea = document.getElementById('game-area');
      const rect = gameArea.getBoundingClientRect();

      const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
      const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

      let x = clientX - rect.left - offsetX;
      let y = clientY - rect.top - offsetY;

      x = Math.max(0, Math.min(x, rect.width - 60));
      y = Math.max(0, Math.min(y, rect.height - 60));

      draggedElement.style.left = x + 'px';
      draggedElement.style.top = y + 'px';

      e.preventDefault();
    }

    function endDrag(e) {
      if (!draggedElement || hasAnswered) return;

      draggedElement.classList.remove('dragging');

      checkAnswer();

      draggedElement = null;
    }

    function checkAnswer() {
      const question = questions[currentQuestionIndex];
      const draggable = document.getElementById('draggable');
      const gameArea = document.getElementById('game-area');
      const table = document.querySelector('.table');
      const drawer = document.querySelector('.drawer');

      const draggableRect = draggable.getBoundingClientRect();
      const tableRect = table.getBoundingClientRect();
      const drawerRect = drawer.getBoundingClientRect();
      const gameAreaRect = gameArea.getBoundingClientRect();

      const draggableCenterX = draggableRect.left + draggableRect.width / 2;
      const draggableCenterY = draggableRect.top + draggableRect.height / 2;

      let isCorrect = false;

      if (question.position === 'on') {
        // ON the table
        if (draggableCenterY < tableRect.bottom && draggableCenterY > tableRect.top - 40 &&
            draggableCenterX > tableRect.left && draggableCenterX < tableRect.right) {
          isCorrect = true;
        }
      } else if (question.position === 'under') {
        // UNDER the table
        if (draggableCenterY > tableRect.bottom && draggableCenterY < tableRect.bottom + 100 &&
            draggableCenterX > tableRect.left && draggableCenterX < tableRect.right) {
          isCorrect = true;
        }
      } else if (question.position === 'left') {
        // LEFT of the table
        if (draggableCenterX < tableRect.left - 20 &&
            draggableCenterY > tableRect.top - 50 && draggableCenterY < tableRect.bottom + 50) {
          isCorrect = true;
        }
      } else if (question.position === 'right') {
        // RIGHT of the table
        if (draggableCenterX > tableRect.right + 20 &&
            draggableCenterY > tableRect.top - 50 && draggableCenterY < tableRect.bottom + 50) {
          isCorrect = true;
        }
      } else if (question.position === 'in') {
        // IN the drawer
        if (draggableCenterX > drawerRect.left && draggableCenterX < drawerRect.right &&
            draggableCenterY > drawerRect.top && draggableCenterY < drawerRect.bottom) {
          isCorrect = true;
        }
      }

      hasAnswered = true;
      const feedback = document.getElementById('feedback');

      if (isCorrect) {
        correctCount++;
        feedback.className = 'feedback correct';
        feedback.innerHTML = `<div>‚úì Correct! Great job!</div>`;
      } else {
        feedback.className = 'feedback incorrect';
        feedback.innerHTML = `
          <div>‚úó Not quite right. The correct answer is:</div>
          <div class="chinese-answer">${question.text.toUpperCase()} (${question.chinese})</div>
        `;
      }

      updateScore();
      document.getElementById('next-button').disabled = false;
    }

    function updateScore() {
      document.getElementById('correct-count').textContent = correctCount;
      const accuracy = Math.round((correctCount / (currentQuestionIndex + 1)) * 100);
      document.getElementById('accuracy').textContent = accuracy + '%';
    }

    function nextQuestion() {
      currentQuestionIndex++;

      if (currentQuestionIndex >= questions.length) {
        showCompletionScreen();
      } else {
        loadQuestion();
      }
    }

    function showCompletionScreen() {
      document.getElementById('game-content').style.display = 'none';
      document.getElementById('completion-screen').style.display = 'block';
      document.getElementById('final-score').textContent = `${correctCount} / ${questions.length}`;
    }

    function restartGame() {
      currentQuestionIndex = 0;
      correctCount = 0;
      document.getElementById('game-content').style.display = 'block';
      document.getElementById('completion-screen').style.display = 'none';
      loadQuestion();
      updateScore();
    }

    document.getElementById('next-button').addEventListener('click', nextQuestion);

    // Add keyboard support for spacebar
    document.addEventListener('keydown', function(e) {
      if (e.code === 'Space' && !document.getElementById('next-button').disabled) {
        e.preventDefault();
        nextQuestion();
      }
    });

    async function onConfigChange(config) {
      const gameTitle = config.game_title || defaultConfig.game_title;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const successColor = config.success_color || defaultConfig.success_color;

      document.getElementById('game-title').textContent = gameTitle;
      document.querySelector('h1').style.color = primaryColor;
      document.querySelectorAll('.score-value').forEach(el => el.style.color = primaryColor);
      document.querySelector('.question-area').style.borderColor = accentColor;
      document.querySelector('.next-button').style.background = primaryColor;
      document.querySelector('.restart-button').style.background = successColor;
      document.querySelector('body').style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${config.secondary_color || defaultConfig.secondary_color} 100%)`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            },
            {
              get: () => config.success_color || defaultConfig.success_color,
              set: (value) => {
                config.success_color = value;
                window.elementSdk.setConfig({ success_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["instruction_text", config.instruction_text || defaultConfig.instruction_text]
        ])
      });
    }

    initGame();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99a281b4e5aba9cd',t:'MTc2MjQxMDI1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
