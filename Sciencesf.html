<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÊñáÂñÆÂ≠óÁ∑¥ÁøíÂô®</title>
    <style>
        :root { --blue: #3182ce; --green: #38a169; --red: #e53e3e; --gray: #f7fafc; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #edf2f7; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        
        /* ÈÄ≤Â∫¶Ê¢ù */
        .progress-box { margin-bottom: 20px; }
        .bar-bg { background: #e2e8f0; height: 10px; border-radius: 5px; overflow: hidden; }
        #bar-fill { background: var(--green); width: 0%; height: 100%; transition: 0.3s; }
        .info { display: flex; justify-content: space-between; font-size: 12px; color: #718096; margin-bottom: 4px; }

        .tag { color: var(--blue); font-weight: bold; font-size: 14px; display: block; margin-bottom: 10px; }
        .chinese { font-size: 32px; font-weight: bold; margin: 10px 0; color: #2d3748; }
        .mask { font-size: 24px; letter-spacing: 4px; font-family: monospace; color: var(--blue); margin: 15px 0; min-height: 36px; }

        input { width: 90%; padding: 12px; font-size: 18px; border: 2px solid #cbd5e0; border-radius: 6px; text-align: center; outline: none; }
        input:focus { border-color: var(--blue); }

        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt-btn { padding: 12px; border: 1px solid #e2e8f0; background: white; cursor: pointer; border-radius: 6px; font-size: 16px; }
        .opt-btn:hover { background: #f7fafc; border-color: var(--blue); }

        .msg { margin-top: 15px; font-weight: bold; min-height: 24px; }
        .btn-next { width: 100%; padding: 12px; background: var(--blue); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; display: none; margin-top: 10px; }
        .reset { margin-top: 30px; font-size: 12px; color: #a0aec0; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

<div class="container" id="app">
    <div class="progress-box">
        <div class="info">
            <span id="label-step">ÈÄ≤Â∫¶</span>
            <span id="label-percent">0%</span>
        </div>
        <div class="bar-bg"><div id="bar-fill"></div></div>
    </div>

    <span class="tag" id="label-stage">ÈöéÊÆµ</span>
    <div class="chinese" id="display-cn">ËºâÂÖ•‰∏≠...</div>

    <div id="choice-mode">
        <div class="options" id="options-grid"></div>
    </div>

    <div id="spell-mode" style="display:none;">
        <div class="mask" id="display-mask"></div>
        <input type="text" id="input-word" placeholder="Ëº∏ÂÖ•ÂÆåÊåâ Enter" autocomplete="off">
    </div>

    <div class="msg" id="display-msg"></div>
    <button class="btn-next" id="btn-next" onclick="toNext()">‰∏ã‰∏ÄÈ°å</button>
    <div class="reset" onclick="resetGame()">ÈáçÊñ∞ÈñãÂßãÈÅäÊà≤</div>
</div>

<script>
    // 1. Ë®≠ÂÆöÂñÆÂ≠óËàáÈóúÂç°
    const WORDS = [
        { en: 'science', cn: 'ÁßëÂ≠∏' },
        { en: 'subject', cn: 'ÁßëÁõÆ' },
        { en: 'favorite', cn: 'ÊúÄÂñúÊÑõÁöÑ' }
    ];

    const STAGES = [
        { name: 'ÈöéÊÆµ 1ÔºöÁúã‰∏≠ÊñáÈÅ∏Ëã±Êñá', mode: 'choice', holes: 0 },
        { name: 'ÈöéÊÆµ 2ÔºöÂ°´Á©∫ (Áº∫2Â≠ó)', mode: 'spell', holes: 2 },
        { name: 'ÈöéÊÆµ 3ÔºöÂ°´Á©∫ (Áº∫3Â≠ó)', mode: 'spell', holes: 3 },
        { name: 'ÈöéÊÆµ 4ÔºöÂÖ®ÊãºÊåëÊà∞', mode: 'spell', holes: 99 }
    ];

    // 2. ËÆÄÂèñÂÑ≤Â≠òË≥áÊñô
    let current = JSON.parse(localStorage.getItem('study_pos')) || { s: 0, w: 0 };

    function save() { localStorage.setItem('study_pos', JSON.stringify(current)); }

    // 3. Ê∏≤ÊüìÁï´Èù¢
    function render() {
        if (current.s >= STAGES.length) {
            showFinal();
            return;
        }

        const stage = STAGES[current.s];
        const word = WORDS[current.w];
        const total = STAGES.length * WORDS.length;
        const count = (current.s * WORDS.length) + current.w;
        const percent = Math.floor((count / total) * 100);

        document.getElementById('label-stage').innerText = stage.name;
        document.getElementById('display-cn').innerText = word.cn;
        document.getElementById('label-percent').innerText = percent + "%";
        document.getElementById('label-step').innerText = `Á¨¨ ${count + 1} / ${total} È°å`;
        document.getElementById('bar-fill').style.width = percent + "%";
        document.getElementById('display-msg').innerText = "";
        document.getElementById('btn-next').style.display = "none";

        if (stage.mode === 'choice') {
            document.getElementById('choice-mode').style.display = "block";
            document.getElementById('spell-mode').style.display = "none";
            makeOptions(word.en);
        } else {
            document.getElementById('choice-mode').style.display = "none";
            document.getElementById('spell-mode').style.display = "block";
            makeSpell(word.en, stage.holes);
        }
    }

    function makeOptions(correct) {
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";
        let opts = [correct];
        while(opts.length < 4 && opts.length < WORDS.length) {
            let r = WORDS[Math.floor(Math.random()*WORDS.length)].en;
            if(!opts.includes(r)) opts.push(r);
        }
        opts.sort(() => Math.random() - 0.5).forEach(text => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = text;
            btn.onclick = () => check(text === correct, correct);
            grid.appendChild(btn);
        });
    }

    function makeSpell(en, holes) {
        let m = "";
        let hIdx = [];
        if (holes >= en.length) {
            m = "_ ".repeat(en.length);
        } else {
            while(hIdx.length < holes) {
                let r = Math.floor(Math.random()*en.length);
                if(!hIdx.includes(r)) hIdx.push(r);
            }
            for(let i=0; i<en.length; i++) m += hIdx.includes(i) ? "_ " : en[i] + " ";
        }
        document.getElementById('display-mask').innerText = m;
        const input = document.getElementById('input-word');
        input.value = "";
        input.disabled = false;
        input.focus();
        input.onkeydown = (e) => { if(e.key === 'Enter') check(input.value.toLowerCase().trim() === en, en); };
    }

    function check(isOk, ans) {
        const msg = document.getElementById('display-msg');
        msg.innerText = isOk ? "‚úÖ Á≠îÂ∞ç‰∫ÜÔºÅ" : "‚ùå Ê≠£Á¢∫Á≠îÊ°à: " + ans;
        msg.style.color = isOk ? "var(--green)" : "var(--red)";
        document.getElementById('btn-next').style.display = "block";
        const input = document.getElementById('input-word');
        if(input) input.disabled = true;
    }

    function toNext() {
        current.w++;
        if (current.w >= WORDS.length) { current.w = 0; current.s++; }
        save();
        render();
    }

    function showFinal() {
        document.getElementById('bar-fill').style.width = "100%";
        document.getElementById('label-percent').innerText = "100%";
        document.getElementById('app').innerHTML = `<h2>üéâ ÊåëÊà∞ÂÆåÊàêÔºÅ</h2><p>‰Ω†Â∑≤Á∂ìÁ≤æÈÄöÈÄôÁµÑÂñÆÂ≠ó‰∫Ü„ÄÇ</p><button class="opt-btn" onclick="resetGame()" style="width:100%">ÈáçÊñ∞ÈñãÂßã</button>`;
    }

    function resetGame() { localStorage.removeItem('study_pos'); location.reload(); }

    // ÈñãÂßãÂü∑Ë°å
    render();
</script>

</body>
</html>
