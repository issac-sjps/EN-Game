<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡å–®å­—é€²éšæŒ‘æˆ°è³½</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #48bb78;
            --bg: #f0f4f8;
        }

        body { 
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; 
            background: var(--bg); 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            margin: 0;
        }

        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 450px; 
            text-align: center; 
        }

        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-wrapper {
            margin-bottom: 20px;
        }
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
        }
        .progress-bg {
            background: #e2e8f0;
            border-radius: 10px;
            height: 12px;
            width: 100%;
            overflow: hidden;
        }
        #progress-fill {
            background: var(--success);
            height: 100%;
            width: 0%;
            transition: width 0.4s ease;
        }

        .level-tag { 
            background: #ebf4ff;
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .cn-hint { font-size: 2.2rem; margin: 20px 0; font-weight: bold; color: #2d3748; }
        
        .word-box { 
            font-size: 1.8rem; 
            letter-spacing: 4px; 
            margin: 20px 0; 
            color: var(--primary); 
            min-height: 1.5em;
            font-family: 'Courier New', Courier, monospace;
        }

        input { 
            width: 90%; 
            padding: 12px; 
            font-size: 1.2rem; 
            border: 2px solid #cbd5e0; 
            border-radius: 8px; 
            text-align: center; 
            outline: none;
        }
        input:focus { border-color: var(--primary); }

        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .opt-btn { 
            padding: 15px; 
            border: 2px solid #e2e8f0; 
            background: white; 
            cursor: pointer; 
            border-radius: 10px; 
            font-size: 1.1rem;
            transition: all 0.2s;
        }
        .opt-btn:hover { border-color: var(--primary); background: #f7fafc; }

        .msg { margin-top: 20px; font-weight: bold; font-size: 1.1rem; min-height: 1.5em; }
        
        button#nextBtn { 
            margin-top: 20px; 
            padding: 12px; 
            background: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            display: none; 
            width: 100%; 
            font-size: 1.1rem;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="card" id="gameCard">
    <div class="progress-wrapper">
        <div class="progress-info">
            <span id="progress-percent">é€²åº¦: 0%</span>
            <span id="progress-count">0 / 0</span>
        </div>
        <div class="progress-bg">
            <div id="progress-fill"></div>
        </div>
    </div>

    <div class="level-tag" id="levelTitle">è¼‰å…¥ä¸­...</div>
    <div class="cn-hint" id="cnText">å–®å­—</div>
    
    <div id="choiceArea">
        <div class="option-grid" id="options"></div>
    </div>

    <div id="spellArea" style="display:none;">
        <div class="word-box" id="maskDisplay"></div>
        <input type="text" id="wordInput" placeholder="è«‹è¼¸å…¥å®Œæ•´å–®å­—ä¸¦æŒ‰å›è»Š" autocomplete="off">
    </div>

    <div class="msg" id="msgBox"></div>
    <button id="nextBtn" onclick="goToNext()">ä¸‹ä¸€é¡Œ</button>
</div>

<script>
    const vocabulary = [
        { en: 'science', cn: 'ç§‘å­¸' },
        { en: 'subject', cn: 'ç§‘ç›®' },
        { en: 'favorite', cn: 'æœ€å–œæ„›çš„' }
    ];

    const stages = [
        { mode: 'choice', holes: 0, title: 'éšæ®µ 1ï¼šå­—ç¾©é¸æ“‡' },
        { mode: 'spell', holes: 2, title: 'éšæ®µ 2ï¼šå¡«ç©º (ç¼º2å­—)' },
        { mode: 'spell', holes: 3, title: 'éšæ®µ 3ï¼šå¡«ç©º (ç¼º3å­—)' },
        { mode: 'spell', holes: 99, title: 'æœ€çµ‚éšæ®µï¼šå…¨æ‹¼ç·´ç¿’' }
    ];

    let sIdx = 0; // ç•¶å‰éšæ®µç´¢å¼•
    let wIdx = 0; // ç•¶å‰å–®å­—ç´¢å¼•
    let isFinished = false;

    function initGame() {
        renderQuestion();
    }

    function updateProgressBar() {
        const totalSteps = stages.length * vocabulary.length;
        const currentStep = (sIdx * vocabulary.length) + wIdx;
        const percentage = Math.floor((currentStep / totalSteps) * 100);
        
        document.getElementById('progress-fill').style.width = percentage + "%";
        document.getElementById('progress-percent').innerText = `ç¸½é€²åº¦: ${percentage}%`;
        document.getElementById('progress-count').innerText = `${currentStep} / ${totalSteps}`;
    }

    function renderQuestion() {
        isFinished = false;
        const stage = stages[sIdx];
        const word = vocabulary[wIdx];
        
        updateProgressBar();

        document.getElementById('levelTitle').innerText = stage.title;
        document.getElementById('cnText').innerText = word.cn;
        document.getElementById('msgBox').innerText = "";
        document.getElementById('nextBtn').style.display = "none";

        if (stage.mode === 'choice') {
            document.getElementById('choiceArea').style.display = "block";
            document.getElementById('spellArea').style.display = "none";
            setupChoiceMode(word.en);
        } else {
            document.getElementById('choiceArea').style.display = "none";
            document.getElementById('spellArea').style.display = "block";
            setupSpellMode(word.en, stage.holes);
        }
    }

    function setupChoiceMode(correct) {
        const optDiv = document.getElementById('options');
        optDiv.innerHTML = "";
        let choices = [correct];
        while(choices.length < 4) {
            let r = vocabulary[Math.floor(Math.random()*vocabulary.length)].en;
            if(!choices.includes(r)) choices.push(r);
        }
        choices.sort(() => Math.random() - 0.5).forEach(text => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = text;
            btn.onclick = () => {
                if(isFinished) return;
                checkAnswer(text === correct, correct);
            };
            optDiv.appendChild(btn);
        });
    }

    function setupSpellMode(en, holes) {
        let display = "";
        if (holes >= en.length) {
            display = "_ ".repeat(en.length);
        } else {
            let hiddenIndices = [];
            while(hiddenIndices.length < holes) {
                let r = Math.floor(Math.random()*en.length);
                if(!hiddenIndices.includes(r)) hiddenIndices.push(r);
            }
            for(let i=0; i<en.length; i++) {
                display += hiddenIndices.includes(i) ? "_ " : en[i] + " ";
            }
        }
        document.getElementById('maskDisplay').innerText = display;
        const input = document.getElementById('wordInput');
        input.value = "";
        input.disabled = false;
        input.focus();
        input.onkeypress = (e) => {
            if(e.key === 'Enter') checkAnswer(input.value.toLowerCase().trim() === en, en);
        };
    }

    function checkAnswer(isCorrect, correctAns) {
        isFinished = true;
        const msg = document.getElementById('msgBox');
        if (isCorrect) {
            msg.innerText = "âœ… å¤ªæ£’äº†ï¼Œç­”å°äº†ï¼";
            msg.style.color = "#38a169";
        } else {
            msg.innerText = "âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯: " + correctAns;
            msg.style.color = "#e53e3e";
        }
        document.getElementById('nextBtn').style.display = "block";
        document.getElementById('wordInput').disabled = true;
    }

    function goToNext() {
        wIdx++;
        if(wIdx >= vocabulary.length) {
            wIdx = 0;
            sIdx++;
        }

        if(sIdx >= stages.length) {
            // å®Œæˆæ‰€æœ‰æŒ‘æˆ°
            document.getElementById('progress-fill').style.width = "100%";
            document.getElementById('progress-percent').innerText = "é€²åº¦: 100%";
            document.getElementById('gameCard').innerHTML = `
                <h1 style="color:#38a169">ğŸ‰ æ­å–œç•¢æ¥­ï¼</h1>
                <p>ä½ å·²ç¶“å®Œå…¨æŒæ¡äº†é€™çµ„å–®å­—ã€‚</p>
                <button class="opt-btn" style="width:100%; margin-top:20px;" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
            `;
        } else {
            renderQuestion();
        }
    }

    initGame();
</script>

</body>
</html>
