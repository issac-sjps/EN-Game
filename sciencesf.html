<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å–®å­—é€²éšæŒ‘æˆ°</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .level { color: #666; font-size: 0.9em; }
        .cn { font-size: 2em; margin: 10px 0; font-weight: bold; }
        .word-box { font-size: 1.5em; letter-spacing: 3px; margin: 20px 0; color: #007bff; min-height: 1.5em; }
        input { width: 80%; padding: 10px; font-size: 1.1em; border: 2px solid #ddd; border-radius: 5px; text-align: center; }
        button { margin-top: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; display: none; width: 100%; }
        .msg { margin-top: 15px; font-weight: bold; min-height: 1.2em; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt { padding: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; border-radius: 5px; }
        .opt:hover { background: #f8f9fa; }
    </style>
</head>
<body>

<div class="card" id="main">
    <div class="level" id="lvlText">è¼‰å…¥ä¸­...</div>
    <div class="cn" id="cnText">å–®å­—</div>
    
    <div id="quizArea">
        <div class="option-grid" id="options"></div>
    </div>

    <div id="spellArea" style="display:none;">
        <div class="word-box" id="mask"></div>
        <input type="text" id="userInput" placeholder="è¼¸å…¥å–®å­—ä¸¦æŒ‰Enter" autocomplete="off">
    </div>

    <div class="msg" id="msg"></div>
    <button id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€å€‹é¡Œç›®</button>
</div>

<script>
    const words = [
        { en: 'science', cn: 'ç§‘å­¸' },
        { en: 'subject', cn: 'ç§‘ç›®' },
        { en: 'favorite', cn: 'æœ€å–œæ„›çš„' }
    ];

    const stages = [
        { mode: 'choice', holes: 0, title: 'éšæ®µ 1ï¼šçœ‹ä¸­æ–‡é¸è‹±æ–‡' },
        { mode: 'spell', holes: 2, title: 'éšæ®µ 2ï¼šå¡«ç©º (ç¼º2å­—)' },
        { mode: 'spell', holes: 3, title: 'éšæ®µ 3ï¼šå¡«ç©º (ç¼º3å­—)' },
        { mode: 'spell', holes: 99, title: 'éšæ®µ 4ï¼šå…¨æ‹¼ç·´ç¿’' }
    ];

    let sIdx = 0, wIdx = 0, finished = false;

    function render() {
        const stage = stages[sIdx];
        const word = words[wIdx];
        document.getElementById('lvlText').innerText = stage.title;
        document.getElementById('cnText').innerText = word.cn;
        document.getElementById('msg').innerText = "";
        document.getElementById('nextBtn').style.display = "none";

        if (stage.mode === 'choice') {
            document.getElementById('quizArea').style.display = "block";
            document.getElementById('spellArea').style.display = "none";
            makeOptions(word.en);
        } else {
            document.getElementById('quizArea').style.display = "none";
            document.getElementById('spellArea').style.display = "block";
            makeSpell(word.en, stage.holes);
        }
    }

    function makeOptions(correct) {
        const optDiv = document.getElementById('options');
        optDiv.innerHTML = "";
        let alts = [correct];
        while(alts.length < 4) {
            let r = words[Math.floor(Math.random()*words.length)].en;
            if(!alts.includes(r)) alts.push(r);
        }
        alts.sort(() => Math.random() - 0.5).forEach(t => {
            const b = document.createElement('div');
            b.className = 'opt';
            b.innerText = t;
            b.onclick = () => {
                if(finished) return;
                check(t === correct, correct);
            };
            optDiv.appendChild(b);
        });
        finished = false;
    }

    function makeSpell(en, holes) {
        let m = "";
        if (holes >= en.length) {
            m = "_ ".repeat(en.length);
        } else {
            let hIdx = [];
            while(hIdx.length < holes) {
                let r = Math.floor(Math.random()*en.length);
                if(!hIdx.includes(r)) hIdx.push(r);
            }
            for(let i=0; i<en.length; i++) m += hIdx.includes(i) ? "_ " : en[i] + " ";
        }
        document.getElementById('mask').innerText = m;
        const input = document.getElementById('userInput');
        input.value = "";
        input.disabled = false;
        input.focus();
        input.onkeypress = (e) => { if(e.key === 'Enter') check(input.value.toLowerCase().trim() === en, en); };
        finished = false;
    }

    function check(isRight, ans) {
        finished = true;
        const m = document.getElementById('msg');
        m.innerText = isRight ? "âœ… å¤ªæ£’äº†ï¼" : "âŒ æ‡‰è©²æ˜¯: " + ans;
        m.style.color = isRight ? "green" : "red";
        document.getElementById('nextBtn').style.display = "block";
        document.getElementById('userInput').disabled = true;
    }

    function nextQuestion() {
        wIdx++;
        if(wIdx >= words.length) { wIdx = 0; sIdx++; }
        if(sIdx >= stages.length) {
            document.getElementById('main').innerHTML = "<h2>ğŸ‰ å…¨éƒ¨å®Œæˆï¼</h2><button style='display:block' onclick='location.reload()'>å†ç·´ç¿’ä¸€æ¬¡</button>";
        } else { render(); }
    }

    render();
</script>
</body>
</html>
