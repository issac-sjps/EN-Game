<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®å­—é©—æ”¶ï¼šæ˜ŸæœŸäºŒè‡³æ˜ŸæœŸå››</title>
    <style>
        :root { 
            --primary: #4a90e2; 
            --success: #48bb78; 
            --error: #f56565; 
            --bg: #f7fafc; 
            --dark: #2d3748; 
            --card-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; min-height: 100vh; }
        .card { background: white; width: 100%; max-width: 550px; padding: 30px; border-radius: 24px; box-shadow: var(--card-shadow); text-align: center; position: relative; align-self: flex-start; }
        
        /* é ‚éƒ¨è³‡è¨Šå€ */
        .header-info { margin-bottom: 25px; border-bottom: 2px solid #edf2f7; padding-bottom: 20px; }
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; font-size: 15px; }
        .stat-box { background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #e2e8f0; color: var(--dark); }
        .stat-val { font-weight: 800; color: var(--primary); font-size: 18px; }

        .prog-bar-bg { background: #e2e8f0; height: 10px; border-radius: 5px; overflow: hidden; margin-top: 15px; }
        #prog-fill { background: var(--success); width: 0%; height: 100%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        .stage-tag { background: #ebf8ff; color: var(--primary); padding: 6px 20px; border-radius: 50px; font-size: 14px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
        .hint-cn { font-size: 42px; font-weight: 800; margin: 20px 0; color: var(--dark); letter-spacing: 2px; }

        /* æ‹¼å­—å€ï¼šæ ¼å­å„ªåŒ– */
        .word-slots { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 30px 0; min-height: 60px; }
        .slot { width: 40px; height: 55px; border-bottom: 3px solid #cbd5e0; font-size: 32px; font-weight: bold; color: var(--primary); display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .slot.fixed { border-bottom: none; color: #a0aec0; }
        .slot.filled { border-bottom-color: var(--primary); }

        /* å­—æ¯éŠ€è¡Œï¼šæŒ‰éˆ•å„ªåŒ– */
        .letter-bank { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 25px; padding: 20px; background: #f8fafc; border-radius: 18px; border: 1px dashed #cbd5e0; }
        .letter-card { width: 50px; height: 60px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .letter-card:active { transform: translateY(2px); box-shadow: none; }
        .letter-card.used { opacity: 0.15; pointer-events: none; transform: scale(0.9); }

        /* é¸æ“‡é¡Œæ¨¡å¼ */
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin: 25px 0; }
        .opt-btn { padding: 20px; border: 2px solid #e2e8f0; background: white; border-radius: 15px; font-size: 22px; font-weight: bold; cursor: pointer; transition: 0.2s; color: var(--dark); }
        .opt-btn:hover:not(.used) { border-color: var(--primary); background: #f0f7ff; }

        /* åé¥‹èˆ‡æŒ‰éˆ• */
        .msg { margin-top: 20px; font-weight: bold; font-size: 22px; min-height: 33px; }
        .next-btn { width: 100%; padding: 20px; background: var(--primary); color: white; border: none; border-radius: 15px; font-size: 20px; cursor: pointer; display: none; margin-top: 20px; font-weight: bold; box-shadow: 0 4px 14px rgba(74, 144, 226, 0.3); }
        
        /* çµç®—ç•«é¢ */
        .pass-banner { background: #f0fff4; color: #22543d; padding: 25px; border-radius: 20px; border: 2px solid #48bb78; margin-top: 20px; font-size: 20px; font-weight: bold; line-height: 1.6; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }

        .reset-link { margin-top: 40px; font-size: 13px; color: #a0aec0; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

<div class="card" id="game-card">
    <div class="header-info">
        <div class="stats-row">
            <div class="stat-box">æ­£ç¢ºç‡: <span class="stat-val" id="stat-acc">0%</span> (<span id="stat-c">0</span>/<span id="stat-t">0</span>)</div>
            <div class="stat-box">è¨ˆæ™‚: <span class="stat-val" id="timer">00:00</span></div>
        </div>
        <div class="prog-bar-bg"><div id="prog-fill"></div></div>
    </div>

    <span class="stage-tag" id="stage-name">è¼‰å…¥ä¸­...</span>
    <div class="hint-cn" id="display-cn">---</div>

    <div id="ui-choice" style="display:none;">
        <div class="options-grid" id="choice-box"></div>
    </div>

    <div id="ui-spell" style="display:none;">
        <div class="word-slots" id="slots-box"></div>
        <div class="letter-bank" id="bank-box"></div>
    </div>

    <div class="msg" id="msg"></div>
    <button class="next-btn" id="next-btn" onclick="goNext()">ä¸‹ä¸€é¡Œ (ç©ºç™½éµ âµ)</button>

    <div class="reset-link" onclick="resetAll()">æ¸…é™¤é€²åº¦é‡æ–°é–‹å§‹</div>
</div>

<script>
    // ç›®æ¨™å–®å­—
    const WORDS = [
        { en: 'Tuesday', cn: 'æ˜ŸæœŸäºŒ' },
        { en: 'Wednesday', cn: 'æ˜ŸæœŸä¸‰' },
        { en: 'Thursday', cn: 'æ˜ŸæœŸå››' }
    ];

    // é—œå¡è¨­å®š
    const STAGES = [
        { name: 'ç¬¬ 1 éšæ®µï¼šè¾¨è­˜é¸æ“‡', mode: 'choice', holes: 0 },
        { name: 'ç¬¬ 2 éšæ®µï¼šé—œéµå¡«ç©º', mode: 'spell', holes: 2 },
        { name: 'ç¬¬ 3 éšæ®µï¼šé€²éšæŒ‘æˆ°', mode: 'spell', holes: 4 },
        { name: 'ç¬¬ 4 éšæ®µï¼šå…¨æ‹¼é©—æ”¶', mode: 'spell', holes: 99 }
    ];

    // åˆå§‹åŒ–ç‹€æ…‹ (å¾ LocalStorage è®€å–)
    let state = JSON.parse(localStorage.getItem('vocab_weekly_goal')) || { 
        s: 0, w: 0, correct: 0, total: 0, seconds: 0 
    };

    let currentAnswers = []; 
    let targetHoles = [];    
    let timerInterval;

    function save() { localStorage.setItem('vocab_weekly_goal', JSON.stringify(state)); }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (state.s < STAGES.length) {
                state.seconds++;
                updateTimerUI();
                if (state.seconds % 10 === 0) save();
            }
        }, 1000);
    }

    function updateTimerUI() {
        const m = Math.floor(state.seconds / 60).toString().padStart(2, '0');
        const s = (state.seconds % 60).toString().padStart(2, '0');
        document.getElementById('timer').innerText = `${m}:${s}`;
    }

    function render() {
        if (state.s >= STAGES.length) return showFinal();

        const stage = STAGES[state.s];
        const word = WORDS[state.w];
        
        // é€²åº¦æ¢è¨ˆç®—
        const totalTasks = STAGES.length * WORDS.length;
        const currentTask = state.s * WORDS.length + state.w;
        const progressPercent = Math.floor((currentTask / totalTasks) * 100);

        updateTimerUI();
        document.getElementById('stat-c').innerText = state.correct;
        document.getElementById('stat-t').innerText = state.total;
        document.getElementById('stat-acc').innerText = (state.total === 0 ? 0 : Math.floor(state.correct/state.total*100)) + "%";
        document.getElementById('stage-name').innerText = stage.name;
        document.getElementById('display-cn').innerText = word.cn;
        document.getElementById('prog-fill').style.width = progressPercent + "%";
        document.getElementById('msg').innerText = "";
        document.getElementById('next-btn').style.display = "none";

        if (stage.mode === 'choice') {
            document.getElementById('ui-choice').style.display = "block";
            document.getElementById('ui-spell').style.display = "none";
            initChoice(word.en);
        } else {
            document.getElementById('ui-choice').style.display = "none";
            document.getElementById('ui-spell').style.display = "block";
            initSpell(word.en, stage.holes);
        }
    }

    function initChoice(correct) {
        const box = document.getElementById('choice-box');
        box.innerHTML = "";
        let opts = [correct];
        // éš¨æ©Ÿå¾ WORDS ä¸­æŠ“å…¶ä»–é¸é …
        while(opts.length < 3) {
            let r = WORDS[Math.floor(Math.random()*WORDS.length)].en;
            if(!opts.includes(r)) opts.push(r);
        }
        opts.sort(() => Math.random() - 0.5).forEach(t => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = t;
            b.onclick = () => finishStep(t === correct, correct);
            box.appendChild(b);
        });
    }

    function initSpell(en, holes) {
        const slotsBox = document.getElementById('slots-box');
        const bankBox = document.getElementById('bank-box');
        slotsBox.innerHTML = ""; bankBox.innerHTML = "";
        currentAnswers = []; targetHoles = [];

        // æ±ºå®šå“ªäº›ä½ç½®æ˜¯æ´ (hole)
        let indices = Array.from({length: en.length}, (_, i) => i);
        // å¦‚æœä¸æ˜¯å…¨æ‹¼ï¼Œéš¨æ©ŸæŒ‘é¸ä½ç½®ï¼›å¦‚æœæ˜¯å…¨æ‹¼ï¼Œå…¨éƒ¨éƒ½æ˜¯æ´
        if (holes < en.length) {
            indices.sort(() => Math.random() - 0.5);
            targetHoles = indices.slice(0, holes).sort((a,b) => a-b);
        } else {
            targetHoles = indices;
        }

        // å»ºç«‹æ§½ä½
        for(let i=0; i<en.length; i++) {
            const s = document.createElement('div');
            if (targetHoles.includes(i)) {
                s.className = 'slot'; s.id = `slot-${i}`; s.innerText = "";
            } else {
                s.className = 'slot fixed'; s.innerText = en[i];
            }
            slotsBox.appendChild(s);
        }

        // å»ºç«‹å­—æ¯éŠ€è¡Œ
        let letters = targetHoles.map(idx => en[idx]);
        // å¢åŠ  2 å€‹å¹²æ“¾é …
        const alpha = "abcdefghijklmnopqrstuvwxyz";
        while(letters.length < targetHoles.length + 2) {
            let r = alpha[Math.floor(Math.random()*26)];
            // é¿å…å¹²æ“¾é …å‰›å¥½æ˜¯ç­”æ¡ˆï¼Œè®“é›£åº¦é©ä¸­
            if(!letters.includes(r)) letters.push(r);
        }
        letters.sort(() => Math.random() - 0.5);

        letters.forEach(char => {
            const c = document.createElement('div');
            c.className = 'letter-card';
            c.innerText = char;
            c.onclick = () => {
                if (currentAnswers.length < targetHoles.length) {
                    const targetIdx = targetHoles[currentAnswers.length];
                    const slot = document.getElementById(`slot-${targetIdx}`);
                    slot.innerText = char;
                    slot.classList.add('filled');
                    currentAnswers.push(char);
                    c.classList.add('used');
                    if (currentAnswers.length === targetHoles.length) checkSpell(en);
                }
            };
            bankBox.appendChild(c);
        });
    }

    function checkSpell(en) {
        let res = ""; let hP = 0;
        for(let i=0; i<en.length; i++) {
            res += targetHoles.includes(i) ? currentAnswers[hP++] : en[i];
        }
        // æ³¨æ„å¤§å°å¯«ï¼šé€™è£¡æˆ‘å€‘å¼·åˆ¶æª¢æŸ¥ç¬¬ä¸€å€‹å­—æ¯æ˜¯å¦å¤§å¯«ï¼ˆå¦‚æœé¡Œç›®æ˜¯ Tuesdayï¼‰
        finishStep(res === en, en);
    }

    function finishStep(isOk, correct) {
        state.total++;
        if (isOk) state.correct++;
        const msg = document.getElementById('msg');
        msg.innerText = isOk ? "âœ… Excellent!" : "âŒ Keep trying! Correct: " + correct;
        msg.style.color = isOk ? "var(--success)" : "var(--error)";
        document.getElementById('next-btn').style.display = "block";
        document.querySelectorAll('.letter-card, .opt-btn').forEach(el => { 
            el.classList.add('used'); 
            el.style.pointerEvents = "none";
        });
        save();
    }

    function goNext() {
        state.w++;
        if (state.w >= WORDS.length) { state.w = 0; state.s++; }
        save(); render();
    }

    // ç©ºç™½éµå¿«æ·éµ
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && document.getElementById('next-btn').style.display === 'block') {
            e.preventDefault(); goNext();
        }
    });

    function showFinal() {
        clearInterval(timerInterval);
        const finalTime = document.getElementById('timer').innerText;
        const accuracy = Math.floor(state.correct/state.total*100);
        
        document.getElementById('game-card').innerHTML = `
            <h1 style="font-size:80px; margin:20px 0;">ğŸ‰</h1>
            <h2 style="font-size:28px; color:var(--dark);">å…¨éƒ¨éšæ®µå®Œæˆï¼</h2>
            <div style="margin: 20px 0; text-align: left; background: #f8fafc; padding: 20px; border-radius: 15px;">
                <p>âŒ› ç¸½èŠ±è²»æ™‚é–“ï¼š<span class="stat-val">${finalTime}</span></p>
                <p>ğŸ¯ æœ€çµ‚æ­£ç¢ºç‡ï¼š<span class="stat-val">${accuracy}%</span></p>
            </div>
            
            ${accuracy >= 80 ? `
                <div class="pass-banner">
                    ğŸŒŸ æ­å–œé”æˆé©—æ”¶æ¨™æº– ğŸŒŸ<br>
                    è«‹èˆ‰æ‰‹è«‹è€å¸«éç›®çµæœ<br>
                    ã€ ç°½ å èª è­‰ ã€‘
                </div>
            ` : `<p style="color:var(--error); font-weight:bold;">æ­£ç¢ºç‡ä½æ–¼ 80%ï¼Œå»ºè­°å†æŒ‘æˆ°ä¸€æ¬¡ï¼</p>`}

            <button class="next-btn" style="display:block; background:var(--success);" onclick="resetAll()">é‡æ–°é–‹å§‹æ–°æŒ‘æˆ°</button>
        `;
    }

    function resetAll() { 
        if(confirm("ç¢ºå®šè¦æ¸…é™¤é€²åº¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
            localStorage.removeItem('vocab_weekly_goal'); 
            location.reload(); 
        }
    }

    // å•Ÿå‹•
    startTimer();
    render();
</script>
</body>
</html>
